# HTTP

## HTTP 三次握手

1. 客户端向服务器发出连接请求报文，这时，报文首部中的同部位 SYN=1，同时随机生产初始序列号 sqe=x，TCP 客户端进入 SYN-SENT（同步已发送状态）。TCP 规定，SYN 报文段不能携带数据，但需要消耗掉一个序号。这是三次握手的开始。表示客户端想要和服务端建立连接。

2. TCP 服务端收到请求报文后，如果同意连接，则发出确认报文。确认报文中应该 ACK =1，SYN =1，确认号是 ack = x+1。同时也要为自己随机初始化一个序列号 seq =y，此时，TCP 服务器进程进入了 SYN-RCVD（同步收到）状态。这个报文也不能懈怠数据，但是同样要消耗一个序号。这个报文带有 SYN（建立连接）和 ACK（确认）标志。询问客户端是都准备好。

3. TCP 客户端进程收到确认后，还要向服务端给出确认。确认报文的 ACK = 1，ack = y+1，此时，TCP 连接建立，客户端进入 ESTABLISHED（已连接）状态。TCP 规定，ACK 报文段可以携带数据，但是如果不携带数据，则不消耗序号。这里客户端表示我已经准备好。


### 为什么要进行三次握手

client发送了第一个连接的请求报文，但是由于网络不好，这个请求没有立即到达服务端，而是在某个网络节点中滞留了，直到某个时间才到达server，本来这已经是一个失效

的报文，但是server端接收到这个请求报文后，还是会想client发出确认的报文，表示同意连接。假如不采用三次握手，那么只要server发出确认，新的建立就连接了，但其实这个

请求是失效的请求，client是不会理睬server的确认信息，也不会向服务端发送确认的请求，但是server认为新的连接已经建立起来了，并一直等待client发来数据，这样，server的

很多资源就没白白浪费掉了，采用三次握手就是为了防止这种情况的发生，server会因为收不到确认的报文，就知道client并没有建立连接。这就是三次握手的作用。