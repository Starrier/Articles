---
title: mysql-optimize
date: 2019-02-22 22:16:28
tags: MySQL
index_img: ../post_img/set.jpeg
---

## MySQL 优化

### 一. 表相关

 1. 尽量使用 `TINYINT`、`SMALLINT`、`MEDIUM_INT` 作为整数类型。如果数据类型为非负数，则加上 `UNSIGNED`。
 2. `VARCHAR` 长度只会分配真正需要的空间。
 3. 使用枚举或整数代替字符串类型
 4. 尽量使用 `TIMESTAMMP`,而非 `DATETIME`。
 5. 单表不要有太多字段，建议在 **20** 个以内。
 6. 避免使用 `NULL` 字段，因为它难以优化查询，而且会占用额外的索引空间。
 7. `text` 列尽量用单独的表来存储。

### 二. 索引

 1. 索引并不是越多越好，要根据查询有针对性的创建，考虑在涉及 `WHERE` 、`JOIN` 和 `ORDER BY` 命令的列上建立索引字段，可根据 `EXPLAIN` 来查询是否使用了索引或者全表扫描。
 2. 应尽量避免在 `WHERE` 子句中对字段进行 `NULL` 值判断，否则将导致引擎放弃使用索引而进行全表扫描。
 3. 值分布很少的字段不适合建立索引，例如**性别**这种只有两三个值的字段。
 4. 字符字段只建立前缀索引。
 5. 字符字段最好不要做主键。
 6. 不用外键，由程序保证约束。
 7. 尽量不使用 `UNIQUE`，由开发者保证约束。
 8. 使用多列索引时，注意顺序和查询条件的一致性，同时删除不必要的单列索引。
 9. 查询时，只查询需要的字段，无用的字段不要查询，减少查询的额字段列数。

### 三. SQL 查询

 1. 可通过开启慢查询日志来找出较慢的 SQL。
 2. 不做列运算：`SELECT id WHERE age + 1 = 10`,任何对列的操作都会导致表扫描，它包括数据库教程函数、计算表达式等。查询时要尽可能将操作移至等号左边。
 3. SQL 语句尽可能简单，一条 SQL 语句只能在一个 CPU 中进行运算，将大语句拆分成小语句，因为一条大语句可能会拖垮整个数据库。
 4. 不用 `SELECT *`。
 5. `OR` 改为 `IN`。`OR` 的效率是 n 级别的，`IN` 的效率是 log(n) 级别的，`In` 的个数建议控制在 **200** 以内。
 6. 不用函数和触发器，在应用程序中实现。
 7. 避免 `%x` 式查询。
 8. 少用 `JOIN`。
 9. 使用同类型进行比较，比如用 `123` 和 `123` 比较，123 和 123 比。
 10. 尽量避免在 `WHERE` 子句中使用 `!=` 或 `<>` 操作符，否则将导致引擎放弃使用索引转而进行全表扫描。
 11. 对于连续数值，使用  `BETWEEN` 而不使用 `IN`:`SELECT id FROM t WHERE num BETWEEN 1 AND 5`。
 12. 列表数据不要拿全表，要使用 `LIMIT` 来分页，每页数量也不要太大。 
